--------------------------------------------------------
-- Identify number of entries --
--------------------------------------------------------

select count(*) as Entries
from Satisfaction_Airline
/*
Entries
129880
*/

--------------------------------------------------------
-- Identify satisfied/unsatisfied percentage --
--------------------------------------------------------
SELECT
    satisfaction,
    ROUND(COUNT(*) * 100.0 / SUM(COUNT(*)) OVER (), 2) as percentage
FROM Satisfaction_Airline
GROUP BY satisfaction
order by percentage DESC

/*
satisfaction	percentage
satisfied	54.73
dissatisfied	45.27
*/


---------------------------------------------------
-- Identify categories with highest descrepancy between satisfied and dissatisfied--
---------------------------------------------------
SELECT
    round(avg(case when satisfaction = 'satisfied' and seat_comfort > 0 then seat_comfort end) -
          avg(case when satisfaction = 'dissatisfied' and seat_comfort > 0 then seat_comfort end),2) as sat_diss_seat_diff,
          
    round(avg(case when satisfaction = 'satisfied' and food_and_drink > 0 then food_and_drink end) -
          avg(case when satisfaction = 'dissatisfied' and food_and_drink > 0 then food_and_drink end),2) as sat_diss_food_and_drink,
          
    round(avg(case when satisfaction = 'satisfied' and inflight_wifi_service > 0 then inflight_wifi_service end) -
          avg(case when satisfaction = 'dissatisfied' and inflight_wifi_service > 0 then inflight_wifi_service end),2) as sat_diss_wifi,
          
    round(avg(case when satisfaction = 'satisfied' and inflight_entertainment > 0 then inflight_entertainment end) -
          avg(case when satisfaction = 'dissatisfied' and inflight_entertainment > 0 then inflight_entertainment end),2) as sat_diss_entertain,
          
    round(avg(case when satisfaction = 'satisfied' and leg_room_service > 0 then leg_room_service end) -
          avg(case when satisfaction = 'dissatisfied' and leg_room_service > 0 then leg_room_service end),2) as sat_diss_leg_room,
          
    round(avg(case when satisfaction = 'satisfied' and cleanliness > 0 then cleanliness end) -
          avg(case when satisfaction = 'dissatisfied' and cleanliness > 0 then cleanliness end),2) as sat_diss_cleanliness
FROM Satisfaction_Airline;


/*
sat_diss_seat_diff	sat_diss_food_and_drink	sat_diss_wifi	sat_diss_entertain	sat_diss_leg_room	sat_diss_cleanliness
0.91	0.5	0.6	1.48	0.8	0.6
*/
------------------------------------------------------
-- Pivot for better visualization --
------------------------------------------------------
SELECT 'Seat Comfort' AS category,
       round(avg(case when satisfaction = 'satisfied' and seat_comfort > 0 then seat_comfort end) -
             avg(case when satisfaction = 'dissatisfied' and seat_comfort > 0 then seat_comfort end),2) as satisfaction_discrepancy
FROM Satisfaction_Airline
UNION
SELECT 'Food and Drink' AS category,
       round(avg(case when satisfaction = 'satisfied' and food_and_drink > 0 then food_and_drink end) -
             avg(case when satisfaction = 'dissatisfied' and food_and_drink > 0 then food_and_drink end),2) as satisfaction_discrepancy
FROM Satisfaction_Airline
UNION
SELECT 'Inflight Wi-Fi' AS category,
       round(avg(case when satisfaction = 'satisfied' and inflight_wifi_service > 0 then inflight_wifi_service end) -
             avg(case when satisfaction = 'dissatisfied' and inflight_wifi_service > 0 then inflight_wifi_service end),2) as satisfaction_discrepancy
FROM Satisfaction_Airline
UNION
SELECT 'Inflight Entertainment' AS category,
       round(avg(case when satisfaction = 'satisfied' and inflight_entertainment > 0 then inflight_entertainment end) -
             avg(case when satisfaction = 'dissatisfied' and inflight_entertainment > 0 then inflight_entertainment end),2) as satisfaction_discrepancy
FROM Satisfaction_Airline
UNION
SELECT 'Leg Room' AS category,
       round(avg(case when satisfaction = 'satisfied' and leg_room_service > 0 then leg_room_service end) -
             avg(case when satisfaction = 'dissatisfied' and leg_room_service > 0 then leg_room_service end),2) as satisfaction_discrepancy
FROM Satisfaction_Airline
UNION
SELECT 'Cleanliness' AS category,
       round(avg(case when satisfaction = 'satisfied' and cleanliness > 0 then cleanliness end) -
             avg(case when satisfaction = 'dissatisfied' and cleanliness > 0 then cleanliness end),2) as satisfaction_discrepancy
FROM Satisfaction_Airline
UNION
SELECT 'Online Support' AS category,
       round(avg(case when satisfaction = 'satisfied' and online_support > 0 then online_support end) -
             avg(case when satisfaction = 'dissatisfied' and online_support > 0 then online_support end),2) as satisfaction_discrepancy
FROM Satisfaction_Airline
UNION
SELECT 'Ease of Online booking' AS category,
       round(avg(case when satisfaction = 'satisfied' and ease_of_online_booking > 0 then ease_of_online_booking end) -
             avg(case when satisfaction = 'dissatisfied' and ease_of_online_booking > 0 then ease_of_online_booking end),2) as satisfaction_discrepancy
FROM Satisfaction_Airline
UNION
SELECT 'Online boarding' AS category,
       round(avg(case when satisfaction = 'satisfied' and online_boarding > 0 then online_boarding end) -
             avg(case when satisfaction = 'dissatisfied' and online_boarding > 0 then online_boarding end),2) as satisfaction_discrepancy
FROM Satisfaction_Airline
UNION
SELECT 'Baggage handdling' AS category,
       round(avg(case when satisfaction = 'satisfied' and baggage_handling > 0 then baggage_handling end) -
             avg(case when satisfaction = 'dissatisfied' and baggage_handling > 0 then baggage_handling end),2) as satisfaction_discrepancy
FROM Satisfaction_Airline
ORDer by satisfaction_discrepancy DESC;

/*
category	satisfaction_discrepancy
Inflight Entertainment	1.48
Ease of Online booking	1.13
Online Support	1.02
Seat Comfort	0.91
Online boarding	0.88
Leg Room	0.8
Baggage handdling	0.6
Cleanliness	0.6
Inflight Wi-Fi	0.6
Food and Drink	0.5
*/


-------------------------------------------------------------
-- Identify age bucket with highest dissatisfaction percentage
-------------------------------------------------------------
WITH temp_sat AS (
    SELECT
        CASE
            WHEN age < 14 THEN '< 14'
            WHEN age BETWEEN 15 AND 24 THEN '15 - 24'
            WHEN age BETWEEN 25 AND 64 THEN '25 - 64'
            ELSE '> 65'
        END AS age_bucket,
        satisfaction
    FROM Satisfaction_Airline
)

SELECT
    age_bucket,
    ROUND(SUM(CASE WHEN satisfaction = 'dissatisfied' THEN 1 ELSE 0 END) * 100.0 / COUNT(*), 2) AS dissatisfied_percentage
FROM temp_sat
GROUP BY age_bucket
ORDER BY dissatisfied_percentage DESC;


/*
age_bucket	dissatisfied_percentage
> 65	57.78
< 14	57.16
15 - 24	54.48
25 - 64	42.04
*/


